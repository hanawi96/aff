<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Address Typo Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-case {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case h3 {
            margin-top: 0;
            color: #333;
        }
        .input {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #4CAF50;
            background: #f9f9f9;
        }
        .result.error {
            border-left-color: #f44336;
        }
        .result.warning {
            border-left-color: #ff9800;
        }
        .label {
            font-weight: bold;
            color: #666;
            display: inline-block;
            width: 120px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .log-line {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Address Typo Fix</h1>
    <p>Test c√°c tr∆∞·ªùng h·ª£p ƒë·ªãa ch·ªâ c√≥ l·ªói ch√≠nh t·∫£</p>

    <div class="test-case">
        <h3>Test Case 1: L·ªói ch√≠nh t·∫£ "ph√∫ b√≠nh" ‚Üí "Ph√∫ B√¨nh"</h3>
        <div class="input">
            <strong>Input:</strong> x√≥m b√¨nh 1 x√£ ƒëi√™m thuy ph√∫ b√≠nh th√°i nguy√™n
        </div>
        <div class="input">
            <strong>Expected:</strong><br>
            - Province: T·ªânh Th√°i Nguy√™n<br>
            - District: Huy·ªán Ph√∫ B√¨nh (kh√¥ng ph·∫£i Th√†nh ph·ªë Th√°i Nguy√™n)<br>
            - Ward: X√£ ƒêi·ªÅm Th·ª•y<br>
            - Street: x√≥m b√¨nh 1
        </div>
        <button onclick="testCase1()">‚ñ∂ Run Test</button>
        <div id="result1" class="result" style="display:none;"></div>
        <div id="log1" class="log" style="display:none;"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 2: ƒê·ªãa ch·ªâ chu·∫©n (kh√¥ng c√≥ l·ªói)</h3>
        <div class="input">
            <strong>Input:</strong> th√¥n T√¢n D∆∞∆°ng x√£ Nh∆°n An th·ªã x√£ An Nh∆°n t·ªânh B√¨nh ƒê·ªãnh
        </div>
        <div class="input">
            <strong>Expected:</strong><br>
            - Province: T·ªânh B√¨nh ƒê·ªãnh<br>
            - District: Th·ªã x√£ An Nh∆°n<br>
            - Ward: X√£ Nh∆°n An<br>
            - Street: th√¥n T√¢n D∆∞∆°ng
        </div>
        <button onclick="testCase2()">‚ñ∂ Run Test</button>
        <div id="result2" class="result" style="display:none;"></div>
        <div id="log2" class="log" style="display:none;"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 3: ƒê·ªãa ch·ªâ c√≥ d·∫•u ph·∫©y</h3>
        <div class="input">
            <strong>Input:</strong> 221/1 phan huy √≠ch, ph∆∞·ªùng 14, g√≤ v·∫•p
        </div>
        <div class="input">
            <strong>Expected:</strong><br>
            - Province: Th√†nh ph·ªë H·ªì Ch√≠ Minh<br>
            - District: Qu·∫≠n G√≤ V·∫•p<br>
            - Ward: Ph∆∞·ªùng 14<br>
            - Street: 221/1 phan huy √≠ch
        </div>
        <button onclick="testCase3()">‚ñ∂ Run Test</button>
        <div id="result3" class="result" style="display:none;"></div>
        <div id="log3" class="log" style="display:none;"></div>
    </div>

    <script>
        // Capture console.log
        const originalLog = console.log;
        let currentLogDiv = null;

        function captureLog(logDiv) {
            currentLogDiv = logDiv;
            console.log = function(...args) {
                originalLog.apply(console, args);
                if (currentLogDiv) {
                    const line = document.createElement('div');
                    line.className = 'log-line';
                    line.textContent = args.join(' ');
                    currentLogDiv.appendChild(line);
                    currentLogDiv.scrollTop = currentLogDiv.scrollHeight;
                }
            };
        }

        function restoreLog() {
            console.log = originalLog;
            currentLogDiv = null;
        }

        async function runTest(testNum, address, expected) {
            const resultDiv = document.getElementById(`result${testNum}`);
            const logDiv = document.getElementById(`log${testNum}`);
            
            // Clear previous results
            resultDiv.innerHTML = '';
            logDiv.innerHTML = '';
            resultDiv.style.display = 'block';
            logDiv.style.display = 'block';
            
            // Capture logs
            captureLog(logDiv);
            
            try {
                // Call smart paste function
                const result = await smartParseCustomerInfo(address);
                
                restoreLog();
                
                if (!result.success) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>‚ùå Error:</strong> ${result.error}`;
                    return;
                }
                
                const data = result.data.address;
                
                // Check results
                let html = '<strong>üìä Results:</strong><br>';
                html += `<div class="label">Province:</div> ${data.province?.Name || '‚ùå Not found'}<br>`;
                html += `<div class="label">District:</div> ${data.district?.Name || '‚ùå Not found'}<br>`;
                html += `<div class="label">Ward:</div> ${data.ward?.Name || '‚ùå Not found'}<br>`;
                html += `<div class="label">Street:</div> ${data.street || '‚ùå Not found'}<br>`;
                html += `<div class="label">Confidence:</div> ${data.confidence}<br>`;
                
                // Validate against expected
                let allCorrect = true;
                if (expected.province && data.province?.Name !== expected.province) {
                    html += `<br><strong style="color: red;">‚ùå Province mismatch!</strong> Expected: ${expected.province}`;
                    allCorrect = false;
                }
                if (expected.district && data.district?.Name !== expected.district) {
                    html += `<br><strong style="color: red;">‚ùå District mismatch!</strong> Expected: ${expected.district}`;
                    allCorrect = false;
                }
                if (expected.ward && data.ward?.Name !== expected.ward) {
                    html += `<br><strong style="color: orange;">‚ö†Ô∏è Ward mismatch!</strong> Expected: ${expected.ward}`;
                    allCorrect = false;
                }
                if (expected.street && data.street !== expected.street) {
                    html += `<br><strong style="color: orange;">‚ö†Ô∏è Street mismatch!</strong> Expected: ${expected.street}`;
                }
                
                if (allCorrect) {
                    html += '<br><br><strong style="color: green; font-size: 18px;">‚úÖ ALL TESTS PASSED!</strong>';
                    resultDiv.className = 'result';
                } else {
                    resultDiv.className = 'result error';
                }
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                restoreLog();
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Exception:</strong> ${error.message}<br><pre>${error.stack}</pre>`;
            }
        }

        async function testCase1() {
            await runTest(1, 'x√≥m b√¨nh 1 x√£ ƒëi√™m thuy ph√∫ b√≠nh th√°i nguy√™n', {
                province: 'T·ªânh Th√°i Nguy√™n',
                district: 'Huy·ªán Ph√∫ B√¨nh',
                ward: 'X√£ ƒêi·ªÅm Th·ª•y',
                street: 'x√≥m b√¨nh 1'
            });
        }

        async function testCase2() {
            await runTest(2, 'th√¥n T√¢n D∆∞∆°ng x√£ Nh∆°n An th·ªã x√£ An Nh∆°n t·ªânh B√¨nh ƒê·ªãnh', {
                province: 'T·ªânh B√¨nh ƒê·ªãnh',
                district: 'Th·ªã x√£ An Nh∆°n',
                ward: 'X√£ Nh∆°n An',
                street: 'th√¥n T√¢n D∆∞∆°ng'
            });
        }

        async function testCase3() {
            await runTest(3, '221/1 phan huy √≠ch, ph∆∞·ªùng 14, g√≤ v·∫•p', {
                province: 'Th√†nh ph·ªë H·ªì Ch√≠ Minh',
                district: 'Qu·∫≠n G√≤ V·∫•p',
                ward: 'Ph∆∞·ªùng 14',
                street: '221/1 phan huy √≠ch'
            });
        }
    </script>

    <!-- Load dependencies -->
    <script src="/public/assets/js/address-selector.js"></script>
    <script src="/public/assets/js/orders/orders-smart-paste.js"></script>
    <script src="/public/assets/js/orders/orders-address-learning.js"></script>

    <script>
        // Initialize address selector
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üîÑ Loading address data...');
            
            // Initialize addressSelector if not already loaded
            if (!window.addressSelector) {
                window.addressSelector = {
                    data: [],
                    loaded: false
                };
            }
            
            // Load Vietnam address data
            try {
                const response = await fetch('/public/assets/data/vietnamAddress.json');
                const data = await response.json();
                window.addressSelector.data = data;
                window.addressSelector.loaded = true;
                console.log('‚úÖ Address data loaded:', data.length, 'provinces');
            } catch (error) {
                console.error('‚ùå Failed to load address data:', error);
                alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ƒë·ªãa ch·ªâ. Vui l√≤ng ki·ªÉm tra ƒë∆∞·ªùng d·∫´n file.');
            }
        });
    </script>
</body>
</html>
