<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Hi·ªÉn Th·ªã Th√¥ng Tin CTV</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">Test Hi·ªÉn Th·ªã Th√¥ng Tin CTV</h1>
        
        <!-- Box th√¥ng tin CTV gi·ªëng nh∆∞ trong trang ch√≠nh -->
        <div id="collaboratorInfoBox" class="mb-6">
            <div class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 rounded-2xl shadow-lg border border-purple-200 overflow-hidden">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-3">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        <h3 class="text-base font-bold text-white">Th√¥ng Tin C·ªông T√°c Vi√™n</h3>
                    </div>
                </div>
                <div class="p-5">
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <!-- H·ªç T√™n -->
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                <svg class="w-5 h-5 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-xs text-gray-600 mb-1">H·ªç v√† T√™n</p>
                                <p id="ctvName" class="text-sm font-bold text-gray-800 truncate">ƒêang t·∫£i...</p>
                            </div>
                        </div>
                        
                        <!-- S·ªë ƒêi·ªán Tho·∫°i -->
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                <svg class="w-5 h-5 text-pink-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-xs text-gray-600 mb-1">S·ªë ƒêi·ªán Tho·∫°i</p>
                                <p id="ctvPhone" class="text-sm font-bold text-gray-800">ƒêang t·∫£i...</p>
                            </div>
                        </div>
                        
                        <!-- ƒê·ªãa Ch·ªâ -->
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-xs text-gray-600 mb-1">ƒê·ªãa Ch·ªâ</p>
                                <p id="ctvAddress" class="text-sm font-bold text-gray-800 line-clamp-2">ƒêang t·∫£i...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test buttons -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-lg font-bold mb-4">Test Cases</h2>
            <div class="space-y-3">
                <button onclick="testCase1()" class="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    Test 1: Th√¥ng tin ƒë·∫ßy ƒë·ªß (y√™n, 386190596, TP.HCM)
                </button>
                <button onclick="testCase2()" class="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                    Test 2: Th√¥ng tin null (fallback)
                </button>
                <button onclick="testCase3()" class="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
                    Test 3: Th√¥ng tin "Ch∆∞a c·∫≠p nh·∫≠t" (fallback)
                </button>
                <button onclick="testCase4()" class="w-full px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">
                    Test 4: Kh√¥ng c√≥ SƒêT (hi·ªÉn th·ªã ****)
                </button>
                <button onclick="testCase5()" class="w-full px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">
                    Test 5: SƒêT ng·∫Øn (hi·ªÉn th·ªã ****)
                </button>
                <button onclick="testCase6()" class="w-full px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600">
                    Test 6: T√™n vi·∫øt th∆∞·ªùng (nguy·ªÖn vƒÉn a)
                </button>
                <button onclick="testCase7()" class="w-full px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600">
                    Test 7: T√™n vi·∫øt HOA (TR·∫¶N TH·ªä B)
                </button>
            </div>
        </div>

        <!-- Console log -->
        <div class="bg-gray-900 text-green-400 rounded-lg p-4 font-mono text-sm">
            <div id="console" class="whitespace-pre-wrap"></div>
        </div>
    </div>

    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>

    <script>
        // Copy h√†m displayCollaboratorInfo t·ª´ ctv.js
        function displayCollaboratorInfo(ctvInfo) {
            log('üìã displayCollaboratorInfo called with:', ctvInfo);
            
            // Vi·∫øt hoa ch·ªØ c√°i ƒë·∫ßu c·ªßa t√™n
            const capitalizeName = (name) => {
                if (!name) return name;
                
                // T√°ch c√°c t·ª´ b·∫±ng kho·∫£ng tr·∫Øng
                return name.split(' ')
                    .map(word => {
                        if (!word) return word;
                        // Vi·∫øt hoa ch·ªØ c√°i ƒë·∫ßu, vi·∫øt th∆∞·ªùng ph·∫ßn c√≤n l·∫°i
                        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                    })
                    .join(' ');
            };
            
            // Che 4 s·ªë cu·ªëi c·ªßa s·ªë ƒëi·ªán tho·∫°i
            const maskPhone = (phone) => {
                if (!phone) return '****';
                
                let phoneStr = phone.toString().trim();
                
                // N·∫øu l√† "****" th√¨ gi·ªØ nguy√™n
                if (phoneStr === '****') return '****';
                
                // N·∫øu l√† s·ªë ƒëi·ªán tho·∫°i (ch·ªâ ch·ª©a s·ªë)
                if (/^\d+$/.test(phoneStr)) {
                    // Th√™m s·ªë 0 ·ªü ƒë·∫ßu n·∫øu ch∆∞a c√≥ (s·ªë ƒëi·ªán tho·∫°i VN)
                    if (!phoneStr.startsWith('0') && phoneStr.length === 9) {
                        phoneStr = '0' + phoneStr;
                        log('üì± Added leading 0 to phone:', phoneStr);
                    }
                    
                    // N·∫øu ƒë·ªß d√†i (>= 4 s·ªë), che 4 s·ªë cu·ªëi
                    if (phoneStr.length >= 4) {
                        return phoneStr.slice(0, -4) + '****';
                    }
                    // N·∫øu qu√° ng·∫Øn, tr·∫£ v·ªÅ ****
                    return '****';
                }
                
                // N·∫øu l√† text kh√°c, tr·∫£ v·ªÅ ****
                return '****';
            };

            // ƒê·∫£m b·∫£o c√≥ gi√° tr·ªã m·∫∑c ƒë·ªãnh
            const defaultInfo = {
                name: 'C·ªông t√°c vi√™n',
                phone: '****',
                address: 'Xem trong ƒë∆°n h√†ng'
            };

            const finalInfo = {
                name: (ctvInfo && ctvInfo.name) ? capitalizeName(ctvInfo.name) : defaultInfo.name,
                phone: (ctvInfo && ctvInfo.phone) ? ctvInfo.phone : defaultInfo.phone,
                address: (ctvInfo && ctvInfo.address) ? ctvInfo.address : defaultInfo.address
            };

            // C·∫≠p nh·∫≠t th√¥ng tin v√†o box
            const nameEl = document.getElementById('ctvName');
            const phoneEl = document.getElementById('ctvPhone');
            const addressEl = document.getElementById('ctvAddress');

            if (nameEl) {
                nameEl.textContent = finalInfo.name;
            }
            
            if (phoneEl) {
                phoneEl.textContent = maskPhone(finalInfo.phone);
            }
            
            if (addressEl) {
                addressEl.textContent = finalInfo.address;
            }

            log('‚úÖ CTV info displayed:', {
                name: nameEl ? nameEl.textContent : 'element not found',
                phone: phoneEl ? phoneEl.textContent : 'element not found',
                address: addressEl ? addressEl.textContent : 'element not found'
            });
        }

        // Test cases
        function testCase1() {
            clearLog();
            log('üß™ Test Case 1: Th√¥ng tin ƒë·∫ßy ƒë·ªß');
            displayCollaboratorInfo({
                name: 'y√™n',
                phone: '386190596',
                address: 'TP.HCM'
            });
        }

        function testCase6() {
            clearLog();
            log('üß™ Test Case 6: T√™n vi·∫øt th∆∞·ªùng');
            displayCollaboratorInfo({
                name: 'nguy·ªÖn vƒÉn a',
                phone: '901234567',
                address: 'H√† N·ªôi'
            });
        }

        function testCase7() {
            clearLog();
            log('üß™ Test Case 7: T√™n vi·∫øt HOA');
            displayCollaboratorInfo({
                name: 'TR·∫¶N TH·ªä B',
                phone: '912345678',
                address: 'ƒê√† N·∫µng'
            });
        }

        function testCase2() {
            clearLog();
            log('üß™ Test Case 2: Th√¥ng tin null');
            displayCollaboratorInfo(null);
        }

        function testCase3() {
            clearLog();
            log('üß™ Test Case 3: Th√¥ng tin "Ch∆∞a c·∫≠p nh·∫≠t"');
            displayCollaboratorInfo({
                name: 'Ch∆∞a c·∫≠p nh·∫≠t',
                phone: 'Ch∆∞a c·∫≠p nh·∫≠t',
                address: 'Ch∆∞a c·∫≠p nh·∫≠t'
            });
        }

        function testCase4() {
            clearLog();
            log('üß™ Test Case 4: Kh√¥ng c√≥ SƒêT');
            displayCollaboratorInfo({
                name: 'CTV PARTNER001',
                phone: '****',
                address: 'Xem trong ƒë∆°n h√†ng'
            });
        }

        function testCase5() {
            clearLog();
            log('üß™ Test Case 5: SƒêT ng·∫Øn (123)');
            displayCollaboratorInfo({
                name: 'Test User',
                phone: '123',
                address: 'Test Address'
            });
        }

        // Console helpers
        function log(...args) {
            const consoleEl = document.getElementById('console');
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            consoleEl.textContent += message + '\n';
            console.log(...args);
        }

        function clearLog() {
            document.getElementById('console').textContent = '';
        }

        // Auto run test 1 on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(testCase1, 500);
        });
    </script>
</body>
</html>
