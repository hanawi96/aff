<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Province-First Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .test-case {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .test-number {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
        }
        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .status.pass {
            background: #2ecc71;
            color: white;
        }
        .status.fail {
            background: #e74c3c;
            color: white;
        }
        .status.pending {
            background: #95a5a6;
            color: white;
        }
        .input-text {
            background: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .expected, .actual {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .expected {
            background: #d5f4e6;
            border-left: 4px solid #2ecc71;
        }
        .actual {
            background: #fadbd8;
            border-left: 4px solid #e74c3c;
        }
        .actual.match {
            background: #d5f4e6;
            border-left: 4px solid #2ecc71;
        }
        .label {
            font-weight: bold;
            color: #7f8c8d;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .value {
            font-size: 14px;
            color: #2c3e50;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        .pass-rate {
            color: #2ecc71;
        }
        .fail-rate {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Province-First Validation</h1>
    <p>Test thu·∫≠t to√°n m·ªõi v·ªõi c√°c ƒë·ªãa ch·ªâ kh√¥ng c√≥ d·∫•u ph·∫©y, c√≥ pattern: "x√£ [T√™n X√£] [T√™n Huy·ªán] [T√™n T·ªânh]"</p>
    
    <div>
        <button onclick="runAllTests()">‚ñ∂Ô∏è Ch·∫°y t·∫•t c·∫£ test</button>
        <button onclick="runSingleTest(0)">‚ñ∂Ô∏è Test case 1</button>
        <button onclick="clearResults()">üîÑ Reset</button>
    </div>

    <div class="summary" id="summary" style="display: none;">
        <h2>üìä K·∫øt qu·∫£ t·ªïng h·ª£p</h2>
        <div class="summary-stats">
            <div class="stat">
                <div class="stat-value pass-rate" id="passCount">0</div>
                <div class="stat-label">PASS ‚úì</div>
            </div>
            <div class="stat">
                <div class="stat-value fail-rate" id="failCount">0</div>
                <div class="stat-label">FAIL ‚úó</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="passRate">0%</div>
                <div class="stat-label">Pass Rate</div>
            </div>
        </div>
    </div>

    <div id="testResults"></div>

    <script src="/assets/js/address-selector.js"></script>
    <script src="/assets/js/orders/orders-address-learning.js"></script>
    <script src="/assets/js/orders/orders-smart-paste.js"></script>

    <script>
        const testCases = [
            {
                input: "x√£ Ph∆∞·ªõc H√≤a Ph√∫ Gi√°o B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Huy·ªán Ph√∫ Gi√°o",
                    ward: "X√£ Ph∆∞·ªõc H√≤a"
                }
            },
            {
                input: "x√£ T√¢n ƒê·ªãnh B·∫øn C√°t B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Th·ªã x√£ B·∫øn C√°t",
                    ward: "X√£ T√¢n ƒê·ªãnh"
                }
            },
            {
                input: "x√£ An Ph√∫ Thu·∫≠n An B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Th√†nh ph·ªë Thu·∫≠n An",
                    ward: "Ph∆∞·ªùng An Ph√∫"
                }
            },
            {
                input: "x√£ H√≤a Long B√†u B√†ng B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Huy·ªán B√†u B√†ng",
                    ward: "X√£ H√≤a Long"
                }
            },
            {
                input: "x√£ T√¢n H∆∞ng T√¢n Uy√™n B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Th√†nh ph·ªë T√¢n Uy√™n",
                    ward: "X√£ T√¢n H∆∞ng"
                }
            },
            {
                input: "x√£ Ph∆∞·ªõc Vƒ©nh Ph√∫ Gi√°o B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Huy·ªán Ph√∫ Gi√°o",
                    ward: "X√£ Ph∆∞·ªõc Vƒ©nh"
                }
            },
            {
                input: "ph∆∞·ªùng Hi·ªáp Th√†nh Th·ªß D·∫ßu M·ªôt B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Th√†nh ph·ªë Th·ªß D·∫ßu M·ªôt",
                    ward: "Ph∆∞·ªùng Hi·ªáp Th√†nh"
                }
            },
            {
                input: "x√£ T√¢n B√¨nh D·∫ßu Ti·∫øng B√¨nh D∆∞∆°ng",
                expected: {
                    province: "T·ªânh B√¨nh D∆∞∆°ng",
                    district: "Huy·ªán D·∫ßu Ti·∫øng",
                    ward: "X√£ T√¢n B√¨nh"
                }
            },
            // Test v·ªõi t·ªânh kh√°c
            {
                input: "x√£ T√¢n Th√†nh H√†m T√¢n B√¨nh Thu·∫≠n",
                expected: {
                    province: "T·ªânh B√¨nh Thu·∫≠n",
                    district: "Huy·ªán H√†m T√¢n",
                    ward: "X√£ T√¢n Th√†nh"
                }
            },
            {
                input: "x√£ Ph∆∞·ªõc H·∫≠u ƒê·ª©c Linh B√¨nh Thu·∫≠n",
                expected: {
                    province: "T·ªânh B√¨nh Thu·∫≠n",
                    district: "Huy·ªán ƒê·ª©c Linh",
                    ward: "X√£ Ph∆∞·ªõc H·∫≠u"
                }
            }
        ];

        let results = [];

        async function runSingleTest(index) {
            const testCase = testCases[index];
            console.log(`\n${'='.repeat(60)}`);
            console.log(`TEST ${index + 1}: ${testCase.input}`);
            console.log('='.repeat(60));
            
            try {
                const result = await parseAddress(testCase.input);
                
                const pass = 
                    result.province?.Name === testCase.expected.province &&
                    result.district?.Name === testCase.expected.district &&
                    (result.ward?.Name === testCase.expected.ward || 
                     result.ward?.Name.includes(testCase.expected.ward.replace('X√£ ', '').replace('Ph∆∞·ªùng ', '')));
                
                results[index] = {
                    pass,
                    actual: {
                        province: result.province?.Name || 'Kh√¥ng t√¨m th·∫•y',
                        district: result.district?.Name || 'Kh√¥ng t√¨m th·∫•y',
                        ward: result.ward?.Name || 'Kh√¥ng t√¨m th·∫•y'
                    }
                };
                
                displayResult(index);
                updateSummary();
                
            } catch (error) {
                console.error('Error:', error);
                results[index] = {
                    pass: false,
                    actual: {
                        province: 'ERROR',
                        district: 'ERROR',
                        ward: 'ERROR'
                    },
                    error: error.message
                };
                displayResult(index);
                updateSummary();
            }
        }

        async function runAllTests() {
            results = [];
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
            
            for (let i = 0; i < testCases.length; i++) {
                await runSingleTest(i);
                // Small delay to avoid overwhelming the system
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            document.getElementById('summary').style.display = 'block';
        }

        function displayResult(index) {
            const testCase = testCases[index];
            const result = results[index];
            
            const container = document.getElementById('testResults');
            let testDiv = document.getElementById(`test-${index}`);
            
            if (!testDiv) {
                testDiv = document.createElement('div');
                testDiv.id = `test-${index}`;
                testDiv.className = 'test-case';
                container.appendChild(testDiv);
            }
            
            const provinceMatch = result.actual.province === testCase.expected.province;
            const districtMatch = result.actual.district === testCase.expected.district;
            const wardMatch = result.actual.ward === testCase.expected.ward || 
                              result.actual.ward.includes(testCase.expected.ward.replace('X√£ ', '').replace('Ph∆∞·ªùng ', ''));
            
            testDiv.innerHTML = `
                <div class="test-header">
                    <div class="test-number">Test ${index + 1}</div>
                    <div class="status ${result.pass ? 'pass' : 'fail'}">
                        ${result.pass ? '‚úì PASS' : '‚úó FAIL'}
                    </div>
                </div>
                
                <div class="input-text">
                    <strong>Input:</strong> ${testCase.input}
                </div>
                
                <div class="expected">
                    <div class="label">Expected (Mong ƒë·ª£i)</div>
                    <div class="value">
                        üèõÔ∏è T·ªânh: ${testCase.expected.province}<br>
                        üèòÔ∏è Huy·ªán: ${testCase.expected.district}<br>
                        üè† X√£: ${testCase.expected.ward}
                    </div>
                </div>
                
                <div class="actual ${result.pass ? 'match' : ''}">
                    <div class="label">Actual (K·∫øt qu·∫£)</div>
                    <div class="value">
                        üèõÔ∏è T·ªânh: ${result.actual.province} ${provinceMatch ? '‚úì' : '‚úó'}<br>
                        üèòÔ∏è Huy·ªán: ${result.actual.district} ${districtMatch ? '‚úì' : '‚úó'}<br>
                        üè† X√£: ${result.actual.ward} ${wardMatch ? '‚úì' : '‚úó'}
                    </div>
                </div>
                
                ${result.error ? `<div style="color: red; margin-top: 10px;">Error: ${result.error}</div>` : ''}
            `;
        }

        function updateSummary() {
            const passCount = results.filter(r => r && r.pass).length;
            const failCount = results.filter(r => r && !r.pass).length;
            const total = passCount + failCount;
            const passRate = total > 0 ? Math.round((passCount / total) * 100) : 0;
            
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;
            document.getElementById('passRate').textContent = passRate + '%';
            document.getElementById('passRate').className = 'stat-value ' + (passRate >= 80 ? 'pass-rate' : 'fail-rate');
        }

        function clearResults() {
            results = [];
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
        }

        // Initialize address selector
        window.addEventListener('load', async () => {
            if (window.addressSelector && window.addressSelector.init) {
                await window.addressSelector.init();
                console.log('‚úÖ Address selector initialized');
            }
        });
    </script>
</body>
</html>
